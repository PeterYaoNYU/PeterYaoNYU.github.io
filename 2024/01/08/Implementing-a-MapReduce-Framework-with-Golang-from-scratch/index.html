<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Implementing a MapReduce Framework with Golang RPC from scratch - Peter Yuncheng Yao</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Peter&#039;s Blog"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Peter&#039;s Blog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="I just finished one small piece of work this morning, a MapReduce framework, implemented wit Golang RPC. Before I forget everything, I will document the design and code here. For original source code,"><meta property="og:type" content="blog"><meta property="og:title" content="Implementing a MapReduce Framework with Golang RPC from scratch"><meta property="og:url" content="http://peteryaonyu.github.io/2024/01/08/Implementing-a-MapReduce-Framework-with-Golang-from-scratch/"><meta property="og:site_name" content="Peter Yuncheng Yao"><meta property="og:description" content="I just finished one small piece of work this morning, a MapReduce framework, implemented wit Golang RPC. Before I forget everything, I will document the design and code here. For original source code,"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://avatars.githubusercontent.com/u/93311390?v=4"><meta property="og:image" content="http://peteryaonyu.github.io/images/mapreduce_desc.png"><meta property="article:published_time" content="2024-01-09T04:21:48.000Z"><meta property="article:modified_time" content="2024-01-19T14:20:22.154Z"><meta property="article:author" content="Yuncheng Yao"><meta property="article:tag" content="Distribute Systems"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://avatars.githubusercontent.com/u/93311390?v=4"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://peteryaonyu.github.io/2024/01/08/Implementing-a-MapReduce-Framework-with-Golang-from-scratch/"},"headline":"Implementing a MapReduce Framework with Golang RPC from scratch","image":["http://peteryaonyu.github.io/images/mapreduce_desc.png"],"datePublished":"2024-01-09T04:21:48.000Z","dateModified":"2024-01-19T14:20:22.154Z","author":{"@type":"Person","name":"Yuncheng Yao"},"publisher":{"@type":"Organization","name":"Peter Yuncheng Yao","logo":{"@type":"ImageObject","url":{"text":"Yao Yuncheng(Peter)"}}},"description":"I just finished one small piece of work this morning, a MapReduce framework, implemented wit Golang RPC. Before I forget everything, I will document the design and code here. For original source code,"}</script><link rel="canonical" href="http://peteryaonyu.github.io/2024/01/08/Implementing-a-MapReduce-Framework-with-Golang-from-scratch/"><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.0.0"><link rel="alternate" href="/atom.xml" title="Peter Yuncheng Yao" type="application/atom+xml">
</head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/">Yao Yuncheng(Peter)</a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/CV">CV</a><a class="navbar-item" href="/publication">Publication</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/PeterYaoNYU"><i class="fab fa-github"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2024-01-09T04:21:48.000Z" title="1/8/2024, 11:21:48 PM">2024-01-08</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-01-19T14:20:22.154Z" title="1/19/2024, 9:20:22 AM">2024-01-19</time></span><span class="level-item">12 minutes read (About 1787 words)</span></div></div><h1 class="title is-3 is-size-4-mobile">Implementing a MapReduce Framework with Golang RPC from scratch</h1><div class="content"><p>I just finished one small piece of work this morning, a MapReduce framework, implemented wit Golang RPC. Before I forget everything, I will document the design and code here. For original source code, it is available at <a target="_blank" rel="noopener" href="https://github.com/PeterYaoNYU/mit-distributed-sys">https://github.com/PeterYaoNYU/mit-distributed-sys</a> .</p>
<style>
                /* css part */
                .gr-card {

                    --gr-header-width-proportion: 10%;
                    --gr-footer-width-proportion: 10%;
                    --gr-content-width-proportion: 80%;

                    --gr-header-min-width: 80px;
                    --gr-footer-min-width: 80px;

                    --gr-card-element-margin: 6px 10px 6px 10px; /* header content footer*/

                    display: flex;
                    background-color: #fff;
                    border-radius: 6px;
                    overflow: hidden;
                    box-shadow: 0px 4px 6px rgba(0, 0, 0, .12);
                    margin-bottom: 20px;
                    vertical-align: middle;
                    position: relative;
                }

                .gr-header {
                    width: var(--gr-header-width-proportion);
                    min-width: var(--gr-header-min-width);
                    margin: var(--gr-card-element-margin);
                    background-color: #fff;
                    /* background-color: blueviolet; */
                }

                .gr-header img {
                    width: 80px;
                    height: 80px;
                    position: relative;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%,-50%);
                    object-fit: cover;
                    border-radius: 50%;
                    margin: 0px;
                }

                .gr-content {
                    width: var(--gr-content-width-proportion);
                    margin: var(--gr-card-element-margin);
                    background-color: #fff;
                    text-align: left;
                }

                #gr-github-icon {
                    font-size: 1.3rem;
                }
                .gr-fullname {
                    display: -webkit-box;
                    -webkit-box-orient: vertical;
                    -webkit-line-clamp: 1;
                    overflow: hidden;
                }

                .gr-fullname p {
                    line-height: 2rem;
                    margin: 10px 0px 0px 0px;
                    padding: 0;
                    font-size: .83rem;
                    font-weight: bolder;
                }

                .gr-description {
                    font-size: .8rem;
                    line-height: 1.6rem;
                    display: -webkit-box;
                    -webkit-box-orient: vertical;
                    -webkit-line-clamp: 1;
                    overflow: hidden;
                }

                .gr-footer {
                    width: var(--gr-footer-width-proportion);
                    min-width: var(--gr-footer-min-width);
                    margin: var(--gr-card-element-margin);
                    display: flex;
                    /* background-color: aqua; */
                    background-color: #fff;
                    position: relative;
                    padding: 0px;
                }

                .gr-language-star {
                    margin: auto auto 22px auto;
                    text-align: center;
                    opacity: 1;
                }

                .gr-language {
                    font-size: .8rem;
                    font-weight: 600;
                    line-height: 2.2rem;
                    color: #2070d3;
                }

                #gr-star-icon {
                    font-size: .8rem;
                    display: inherit;
                }

                .gr-card-toolbar{
                    display:flex;
                    width: 100%;
                    height: 100%;

                    position: absolute;

                    opacity: 0;
                    animation: fade-out;
                    animation-duration: .4s;
                    z-index: -1;
                    /* background-color: #2070d3; */
                }

                .gr-repo-link {
                    margin: auto;
                }

                #gr-repo-link-icon {
                    font-size: 16px;
                }
                /* animation part */

                @keyframes fade-in {
                    0% {opacity: 0;}/*初始状态 透明度为0*/
                    100% {opacity: 1;}/*结束状态 透明度为1*/
                }

                @keyframes fade-out {
                    0% {opacity: 1;}/*初始状态 透明度为0*/
                    100% {opacity: 0;}/*结束状态 透明度为1*/
                }

                .gr-card:hover .gr-language-star{
                    opacity: 0;
                    animation: fade-out;
                    animation-duration: .3s;
                }

                .gr-card:hover .gr-card-toolbar{
                    opacity: 1;
                    animation: fade-in;
                    animation-duration: .6s;
                    z-index: 1;
                }
                </style>

                <div class="gr-card">
                    <div class="gr-header">
                        <img src="https://avatars.githubusercontent.com/u/93311390?v=4" alt="">
                    </div>
                    <div class="gr-content">
                        <div class="gr-fullname">
                            <p><i class="fab fa-github fa-lg" aria-hidden="true" id="gr-github-icon"></i> PeterYaoNYU/mit-distributed-sys</p>
                        </div>
                        <div class="gr-description">
                            Distributed System Related Projects in GO: MapReduce, Raft, KV-Storage
                        </div>
                    </div>
                    <div class="gr-footer">
                        <div class="gr-language-star">
                            <span class="gr-language">Go</span>
                            <i class="far fa-star" aria-hidden="true" id='gr-star-icon'> 0</i>
                        </div>
                        <div class="gr-card-toolbar">
                            <div class="gr-repo-link">
                                <a href="https://github.com/PeterYaoNYU/mit-distributed-sys" target="_blank" rel="noopener noreferrer"
                                    title="Open in a new TAB">
                                    <i class="fas fa-external-link-square-alt fa-lg" aria-hidden="true" style="color: black;" id="gr-repo-link-icon"></i>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>

<span id="more"></span>


<p>I have been coding a lot recently, but not much time has been devoted to writing about what I have done. This is perilous, because I will quickly forget what I have done. Replication is super important for finite state machine as well as leanring computer science. </p>
<p>A MapReduce is a paradigm of abstraction for distributed workflows. The orginal paper published by Google is still wildly influentital today, though 2 decades have gone by. It is divided into 2 phases, a <em><strong>map</strong></em> phase, and a <em><strong>reduce</strong></em> phase. I cannot think of a better description than this image found in the original paper:</p>
<p><img src="/images/mapreduce_desc.png"></p>
<p>In another words, MR manages and hides all ascpects of distribution. </p>
<h3 id="An-Abstract-view-of-a-MapReduce-job-–-word-count"><a href="#An-Abstract-view-of-a-MapReduce-job-–-word-count" class="headerlink" title="An Abstract view of a MapReduce job – word count"></a>An Abstract view of a MapReduce job – word count</h3><p>  Input1 -&gt; Map -&gt; a,1 b,1<br>  Input2 -&gt; Map -&gt;     b,1<br>  Input3 -&gt; Map -&gt; a,1     c,1<br>                    |   |   |<br>                    |   |   -&gt; Reduce -&gt; c,1<br>                    |   —–&gt; Reduce -&gt; b,2<br>                    ———&gt; Reduce -&gt; a,2</p>
<ul>
<li>input is (already) split into M files</li>
<li>MR calls Map() for each input file, produces list of k,v pairs<br> “intermediate” data<br> each Map() call is a “task”</li>
<li>when Maps are done,<br> MR gathers all intermediate v’s for each k,<br> and passes each key + values to a Reduce call</li>
<li>final output is set of &lt;k,v&gt; pairs from Reduce()s</li>
</ul>
<hr>
<h2 id="Implementation-of-the-Worker"><a href="#Implementation-of-the-Worker" class="headerlink" title="Implementation of the Worker"></a>Implementation of the Worker</h2><p>The logic for the worker code is more straightforward, and servers as a good starting point. The worker just first acquire the knowledge of how many reduce there are (this decides how many intermediate output each Map should produce), periodically ask for job from the coordinator, wait for the job to arrive, and based on the RPC reply argument, do either Map job or reduce job. After doing the job, report back to the coordinator that the job asked for has been finished, and it can be assigned future tasks then. </p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Worker</span><span class="params">(mapf <span class="keyword">func</span>(<span class="type">string</span>, <span class="type">string</span>)</span></span> []KeyValue,</span><br><span class="line">	reducef <span class="function"><span class="keyword">func</span><span class="params">(<span class="type">string</span>, []<span class="type">string</span>)</span></span> <span class="type">string</span>) &#123;</span><br><span class="line"></span><br><span class="line">	args := GetNReduceArgs&#123;&#125;</span><br><span class="line">	reply := GetNReduceReply&#123;&#125;</span><br><span class="line">	call(<span class="string">&quot;Coordinator.GetNReduce&quot;</span>, &amp;args, &amp;reply)</span><br><span class="line">	nReduce := reply.NReduce</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		<span class="comment">// 1. Request a task from the coordinator</span></span><br><span class="line">		reply, succ := requestTask()</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> !succ &#123;</span><br><span class="line">			<span class="comment">// fmt.Println(&quot;Request task failed&quot;)</span></span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> reply.TaskType == ExitTask &#123;</span><br><span class="line">			<span class="comment">// fmt.Println(&quot;No task left&quot;)</span></span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> reply.TaskType == MapTask &#123;</span><br><span class="line">			doMap(mapf, reply.File, reply.TaskId, nReduce)</span><br><span class="line">			<span class="comment">// 3. Report the task is done to the coordinator</span></span><br><span class="line">			reportMapDone(reply.TaskId)</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="comment">// 2. Do the reduce task</span></span><br><span class="line">			doReduce(reducef, reply.TaskId)</span><br><span class="line">			<span class="comment">// 3. Report the task is done to the coordinator</span></span><br><span class="line">			reportReduceDone(reply.TaskId)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>This is the big framework for the Worker. All we need to do next is to fill in the details. We need to implement:</p>
<ul>
<li>the actual map code and reduce code</li>
<li>report back to the coordinator that the job has been done</li>
<li>A heartbeat function that peridically asks for more task from the coordinator</li>
<li>A writer function that output the intermediate values after Map operation to a shared distributed storage system (Like a Google File System)</li>
</ul>
<p>Let’s fill in the details:<br>This function is asking for tasks periodically</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">requestTask</span><span class="params">()</span></span> (reply *RequestTaskReply, succ <span class="type">bool</span>) &#123;</span><br><span class="line">	args := RequestTaskArgs&#123;WorkerID: os.Getpid()&#125;</span><br><span class="line">	reply = &amp;RequestTaskReply&#123;&#125;</span><br><span class="line">	succ = call(<span class="string">&quot;Coordinator.RequestTask&quot;</span>, &amp;args, reply)</span><br><span class="line">	<span class="keyword">return</span> reply, succ</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>If the task is a Map task, we do the map, and then write to the disk, then report to the coordinator that the map job has been done.</p>
<p>One detail is that, when we are writing to the shared storage, we are not directly writing to it. To be fault tolerant and avoid problems, first we write to a temporary file, and then we do an atomic rename operation.</p>
<p><em><strong>Another Detail</strong></em></p>
<blockquote>
<p>When reporting back to the coordinator that a task is finished, we also need to include the host name and PID, because the coordinator needs to be sure that the output comes from someone that is currently responsible for the job, not someone whe was responsible but got timed out, and then came back live again. I made this mistake before, and it is hard to debug, because it may seem like we don’t need a worker PID in the reply struct. Without this, the MapReduce will fail the Crash unit test. Distributed applications are very hard to debug!!!</p>
</blockquote>
<p>Each intermediate output is hashed to nReduce partitions, for later consumption of the reduce RPC.</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">doMap</span><span class="params">(mapf <span class="keyword">func</span>(<span class="type">string</span>, <span class="type">string</span>)</span></span> []KeyValue, filename <span class="type">string</span>, mapID <span class="type">int</span>, nReduce <span class="type">int</span>) &#123;</span><br><span class="line">	file, err := os.Open(filename)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatalf(<span class="string">&quot;cannot open %v&quot;</span>, filename)</span><br><span class="line">	&#125;</span><br><span class="line">	content, err := ioutil.ReadAll(file)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatalf(<span class="string">&quot;cannot read %v&quot;</span>, filename)</span><br><span class="line">	&#125;</span><br><span class="line">	file.Close()</span><br><span class="line">	kva := mapf(filename, <span class="type">string</span>(content))</span><br><span class="line"></span><br><span class="line">	writeMapOutput(kva, mapID, nReduce)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">reportMapDone</span><span class="params">(TaskId <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">	args := ReportTaskDoneArgs&#123;TaskType: MapTask, TaskId: TaskId, WorkerID: os.Getpid()&#125;</span><br><span class="line">	reply := ReportTaskDoneReply&#123;&#125;</span><br><span class="line">	call(<span class="string">&quot;Coordinator.ReportTaskDone&quot;</span>, &amp;args, &amp;reply)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">writeMapOutput</span><span class="params">(kva []KeyValue, mapID <span class="type">int</span>, nReduce <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">	tempFiles := <span class="built_in">make</span>([]*os.File, nReduce)</span><br><span class="line">	encoders := <span class="built_in">make</span>([]*json.Encoder, nReduce)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; nReduce; i++ &#123;</span><br><span class="line">		tempFile, err := ioutil.TempFile(TempDir, <span class="string">&quot;intermediate-&quot;</span>)</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			log.Fatalf(<span class="string">&quot;cannot create temp file&quot;</span>)</span><br><span class="line">		&#125;</span><br><span class="line">		tempFiles[i] = tempFile</span><br><span class="line">		encoders[i] = json.NewEncoder(tempFiles[i])</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> _, kv := <span class="keyword">range</span> kva &#123;</span><br><span class="line">		<span class="comment">// fmt.Println(nReduce)</span></span><br><span class="line">		reduceID := ihash(kv.Key) % nReduce</span><br><span class="line">		err := encoders[reduceID].Encode(&amp;kv)</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			log.Fatalf(<span class="string">&quot;cannot encode kv&quot;</span>)</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			log.Fatalf(<span class="string">&quot;cannot encode kv&quot;</span>)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i, tempFile := <span class="keyword">range</span> tempFiles &#123;</span><br><span class="line">		tempFile.Close()</span><br><span class="line">		filename := fmt.Sprintf(<span class="string">&quot;%v/mr-%d-%d&quot;</span>, TempDir, mapID, i)</span><br><span class="line">		os.Rename(tempFile.Name(), filename)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Similar procedures happen with the Reduce part of the worker code:</p>
<ul>
<li>get assigned a job</li>
<li>read in the correspond partition based on RPC reply</li>
<li>do the reduce call</li>
<li>write the file back, do atomic rename to be fault tolerant</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">reportReduceDone</span><span class="params">(TaskId <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">	args := ReportTaskDoneArgs&#123;TaskType: ReduceTask, TaskId: TaskId, WorkerID: os.Getpid()&#125;</span><br><span class="line">	reply := ReportTaskDoneReply&#123;&#125;</span><br><span class="line">	call(<span class="string">&quot;Coordinator.ReportTaskDone&quot;</span>, &amp;args, &amp;reply)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">doReduce</span><span class="params">(reducef <span class="keyword">func</span>(<span class="type">string</span>, []<span class="type">string</span>)</span></span> <span class="type">string</span>, reduceID <span class="type">int</span>) &#123;</span><br><span class="line">	<span class="comment">// println(&quot;do reduce called once&quot;)</span></span><br><span class="line">	<span class="comment">// 1. Read all the intermediate files</span></span><br><span class="line">	files, err := filepath.Glob(fmt.Sprintf(<span class="string">&quot;%v/mr-*-%d&quot;</span>, TempDir, reduceID))</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatalf(<span class="string">&quot;cannot read temp files&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// 2. Group the files by key</span></span><br><span class="line"></span><br><span class="line">	intermediate := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>][]<span class="type">string</span>)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> _, filepath := <span class="keyword">range</span> files &#123;</span><br><span class="line">		file, err := os.Open(filepath)</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			log.Fatalf(<span class="string">&quot;cannot open temp file&quot;</span>)</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		dec := json.NewDecoder(file)</span><br><span class="line">		<span class="keyword">for</span> &#123;</span><br><span class="line">			<span class="keyword">var</span> kv KeyValue</span><br><span class="line">			err := dec.Decode(&amp;kv)</span><br><span class="line">			<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">				<span class="keyword">break</span></span><br><span class="line">			&#125;</span><br><span class="line">			intermediate[kv.Key] = <span class="built_in">append</span>(intermediate[kv.Key], kv.Value)</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		file.Close()</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 3. Call reducef on each group</span></span><br><span class="line">	outputFile, err := ioutil.TempFile(TempDir, <span class="string">&quot;mr-out-&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatalf(<span class="string">&quot;cannot create temp file&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> outputFile.Close()</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> key, values := <span class="keyword">range</span> intermediate &#123;</span><br><span class="line">		output := reducef(key, values)</span><br><span class="line">		fmt.Fprintf(outputFile, <span class="string">&quot;%v %v\n&quot;</span>, key, output)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 4. Write the output to a file</span></span><br><span class="line">	finalFilename := fmt.Sprintf(<span class="string">&quot;mr-out-%d&quot;</span>, reduceID)</span><br><span class="line">	os.Rename(outputFile.Name(), finalFilename)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="Implementation-of-the-Coordinator"><a href="#Implementation-of-the-Coordinator" class="headerlink" title="Implementation of the Coordinator"></a>Implementation of the Coordinator</h2><p>When a request for task comes to the coordinator, we need to assign tasks:</p>
<p>Now that we have shared data structures in the coordinator, to avoid race condition, we need extensive locking. Just lock everything that is shared, and you will be fine. </p>
<p>The idea is simple: when a request comes in, assign it either a map task or a reduce task, change the task status, and the worker assigned this task (for timeout operations). Also start a go routine waitTask to check for timeout. If timeout happens, then a process is no longer responsible for a certain task. <em><strong>Even if we get result back from the timed out node, we will discard the result (we need to do extrac check of PID in the result we get back)</strong></em>.</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Coordinator)</span></span> RequestTask(args *RequestTaskArgs, reply *RequestTaskReply) <span class="type">error</span> &#123;</span><br><span class="line">	c.mu.Lock()</span><br><span class="line">	<span class="keyword">defer</span> c.mu.Unlock()</span><br><span class="line">	<span class="keyword">if</span> c.stage == ExitStage &#123;</span><br><span class="line">		reply.TaskType = ExitTask</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> c.stage == MapStage &#123;</span><br><span class="line">		<span class="keyword">for</span> i, task := <span class="keyword">range</span> c.mapTasks &#123;</span><br><span class="line">			<span class="keyword">if</span> task.State == NotStarted &#123;</span><br><span class="line">				c.mapTasks[i].State = Running</span><br><span class="line">				c.mapTasks[i].StartTime = time.Now()</span><br><span class="line">				c.mapTasks[i].WorkerID = args.WorkerID</span><br><span class="line">				reply.TaskType = MapTask</span><br><span class="line">				reply.File = task.File</span><br><span class="line">				reply.TaskId = task.TaskId</span><br><span class="line">				<span class="comment">// fmt.Printf(&quot;Assign map task %v to worker %v, filename:%s\n&quot;, task.TaskId, args.WorkerID, reply.File)</span></span><br><span class="line">				<span class="keyword">go</span> c.waitTask(&amp;c.mapTasks[i])</span><br><span class="line">				<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> c.stage == ReduceStage &#123;</span><br><span class="line">		<span class="keyword">for</span> i, task := <span class="keyword">range</span> c.reduceTasks &#123;</span><br><span class="line">			<span class="keyword">if</span> task.State == NotStarted &#123;</span><br><span class="line">				c.reduceTasks[i].State = Running</span><br><span class="line">				c.reduceTasks[i].StartTime = time.Now()</span><br><span class="line">				c.reduceTasks[i].WorkerID = args.WorkerID</span><br><span class="line">				reply.TaskType = ReduceTask</span><br><span class="line">				reply.TaskId = task.TaskId</span><br><span class="line">				reply.File = task.File</span><br><span class="line">				<span class="keyword">go</span> c.waitTask(&amp;c.reduceTasks[i])</span><br><span class="line">				<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	reply.TaskType = NoTask</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Since we are talking about timeout, here is the implementation:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Coordinator)</span></span> waitTask(task *Task) &#123;</span><br><span class="line">	time.Sleep(<span class="number">10</span> * time.Second)</span><br><span class="line">	c.mu.Lock()</span><br><span class="line">	<span class="keyword">defer</span> c.mu.Unlock()</span><br><span class="line">	<span class="keyword">if</span> task.State == Running &#123;</span><br><span class="line">		<span class="keyword">if</span> task.Type == MapTask &#123;</span><br><span class="line">			fmt.Printf(<span class="string">&quot;Map task %v timeout, reassigning\n&quot;</span>, task.TaskId)</span><br><span class="line">			c.mapTasks[task.TaskId].State = NotStarted</span><br><span class="line">			c.mapTasks[task.TaskId].WorkerID = <span class="number">-1</span></span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			fmt.Printf(<span class="string">&quot;Reduce task %v timeout, reassigning\n&quot;</span>, task.TaskId)</span><br><span class="line">			c.reduceTasks[task.TaskId].State = NotStarted</span><br><span class="line">			c.reduceTasks[task.TaskId].WorkerID = <span class="number">-1</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>If a timeout happens, which we monitor with a go routine, the state of the task, as well its worker, are changed accordingly. Note how we protect shared data structure with a lock. </p>
<p>If we receive a message, saying that a task has been done, we need to do the following:</p>
<ul>
<li>Check the task type, state of the task, and whether the result comes back from someone who is actually responsible for the job. </li>
<li>Change the task status</li>
<li>If all tasks (map and reduce) have been finished, get back to the workers, telling them that we have done all the jobs.</li>
</ul>
<p>Translate the logic into code, and we get:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Coordinator)</span></span> ReportTaskDone(args *ReportTaskDoneArgs, reply *ReportTaskDoneReply) <span class="type">error</span> &#123;</span><br><span class="line">	c.mu.Lock()</span><br><span class="line">	<span class="keyword">defer</span> c.mu.Unlock()</span><br><span class="line">	<span class="keyword">if</span> args.TaskType == MapTask &#123;</span><br><span class="line">		<span class="keyword">if</span> c.mapTasks[args.TaskId].State == Running &amp;&amp; c.mapTasks[args.TaskId].WorkerID != <span class="number">-1</span> &amp;&amp; c.mapTasks[args.TaskId].WorkerID == args.WorkerID &#123;</span><br><span class="line">			c.mapTasks[args.TaskId].State = Finished</span><br><span class="line">			c.mapTasks[args.TaskId].WorkerID = <span class="number">-1</span></span><br><span class="line">			c.nMap -= <span class="number">1</span></span><br><span class="line">			fmt.Printf(<span class="string">&quot;Map task %v finished, nMap: %v, nReduce: %v\n&quot;</span>, args.TaskId, c.nMap, c.nReduce)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> args.TaskType == ReduceTask &#123;</span><br><span class="line">		<span class="keyword">if</span> c.reduceTasks[args.TaskId].State == Running &amp;&amp; c.reduceTasks[args.TaskId].WorkerID != <span class="number">-1</span> &amp;&amp; c.reduceTasks[args.TaskId].WorkerID == args.WorkerID &#123;</span><br><span class="line">			c.reduceTasks[args.TaskId].State = Finished</span><br><span class="line">			c.reduceTasks[args.TaskId].WorkerID = <span class="number">-1</span></span><br><span class="line">			c.nReduce -= <span class="number">1</span></span><br><span class="line">			fmt.Printf(<span class="string">&quot;Reduce task %v finished, nMap: %v, nReduce: %v\n&quot;</span>, args.TaskId, c.nMap, c.nReduce)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> c.nMap == <span class="number">0</span> &amp;&amp; c.nReduce == <span class="number">0</span> &#123;</span><br><span class="line">		<span class="comment">// fmt.Printf(&quot;All tasks finished\n&quot;)</span></span><br><span class="line">		c.stage = ExitStage</span><br><span class="line">		reply.CanExit = <span class="literal">true</span></span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> c.nMap == <span class="number">0</span> &#123;</span><br><span class="line">		c.stage = ReduceStage</span><br><span class="line">		reply.CanExit = <span class="literal">false</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<p>There are some additional details of the code, that I haven’t covered, but the main idea is here. For details, refer back to my source code: <a target="_blank" rel="noopener" href="https://github.com/PeterYaoNYU/mit-distributed-sys">https://github.com/PeterYaoNYU/mit-distributed-sys</a>. </p>
</div><div class="article-licensing box"><div class="licensing-title"><p>Implementing a MapReduce Framework with Golang RPC from scratch</p><p><a href="http://peteryaonyu.github.io/2024/01/08/Implementing-a-MapReduce-Framework-with-Golang-from-scratch/">http://peteryaonyu.github.io/2024/01/08/Implementing-a-MapReduce-Framework-with-Golang-from-scratch/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>Author</h6><p>Yuncheng Yao</p></div></div><div class="level-item is-narrow"><div><h6>Posted on</h6><p>2024-01-08</p></div></div><div class="level-item is-narrow"><div><h6>Updated on</h6><p>2024-01-19</p></div></div><div class="level-item is-narrow"><div><h6>Licensed under</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/Distribute-Systems/">Distribute Systems</a></div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2024/01/12/Consensus-Raft-from-Scratch-Leader-Election/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">[Consensus] Raft from Scratch: Leader Election</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2023/12/18/Database-Bustub-Buffer-Pool-Manager-Implementation/"><span class="level-item">[Database] Bustub Buffer Pool Manager Implementation</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!--></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="/images/avatar.jpg" alt="Yao Yuncheng (Peter)"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Yao Yuncheng (Peter)</p><p class="is-size-6 is-block">yy4108@nyu.edu</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Shanghai</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">8</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">0</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">3</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/PeterYaoNYU" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/PeterYaoNYU"><i class="fab fa-github"></i></a></div></div></div><!--!--><!--!--><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">Recents</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-01-13T14:36:41.000Z">2024-01-13</time></p><p class="title"><a href="/2024/01/13/Database-Implementation-of-an-Entendible-Hash-Index/">[Database] Implementation of an Entendible Hash Index</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-01-12T09:12:17.000Z">2024-01-12</time></p><p class="title"><a href="/2024/01/12/Consensus-Raft-from-Scratch-Leader-Election/">[Consensus] Raft from Scratch: Leader Election</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-01-09T04:21:48.000Z">2024-01-08</time></p><p class="title"><a href="/2024/01/08/Implementing-a-MapReduce-Framework-with-Golang-from-scratch/">Implementing a MapReduce Framework with Golang RPC from scratch</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-12-19T00:18:38.000Z">2023-12-18</time></p><p class="title"><a href="/2023/12/18/Database-Bustub-Buffer-Pool-Manager-Implementation/">[Database] Bustub Buffer Pool Manager Implementation</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-07-10T13:48:33.000Z">2023-07-10</time></p><p class="title"><a href="/2023/07/10/cmu15-213-attack-lab/">CMU15-213 Attack Lab</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">Archives</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2024/"><span class="level-start"><span class="level-item">2024</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/"><span class="level-start"><span class="level-item">2023</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/Database-Systems/"><span class="tag">Database Systems</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Distribute-Systems/"><span class="tag">Distribute Systems</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Operating-Systems/"><span class="tag">Operating Systems</span><span class="tag">2</span></a></div></div></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/">Yao Yuncheng(Peter)</a><p class="is-size-7"><span>&copy; 2024 Yuncheng Yao</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p><p class="is-size-7">© 2023</p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/PeterYaoNYU"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>